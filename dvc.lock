schema: '2.0'
stages:
  prepare:
    cmd: python src/steps/prepare.py data/raw/ data/prepared
    deps:
    - path: data/raw
      hash: md5
      md5: ed7dbcbdabddccca552e276f80fa29ad.dir
      size: 120753872
      nfiles: 3
    - path: src/steps/prepare.py
      hash: md5
      md5: 6bc6f0d7d86d924c78644a61aa4e917d
      size: 7557
    params:
      params.yaml:
        book_column: ISBN
        prepare.book_file: BX-Books.csv
        prepare.rate_file: BX-Book-Ratings.csv
        prepare.users_file: BX-Users.csv
        rating_column: Book-Rating
        user_column: User-ID
    outs:
    - path: data/prepared
      hash: md5
      md5: 28869dd6b569a88cad596a1267dff66c.dir
      size: 74691779
      nfiles: 1
  train:
    cmd: python src/steps/train.py data/split/train.csv data/split/test.csv
    deps:
    - path: data/split/test.csv
      hash: md5
      md5: 57720f02a3b205618ec3022f30ab78ab
      size: 801084
    - path: data/split/train.csv
      hash: md5
      md5: 5985e0a23669913f60a4510d4b3e6ae2
      size: 1868191
    - path: src/steps/train.py
      hash: md5
      md5: 53c62a5d4e63ee6eddeb0ffefaaad2f8
      size: 1570
    outs:
    - path: data/models
      hash: md5
      md5: 786a8de8ebbc063ed6855b492d410e13.dir
      size: 110520530
      nfiles: 1
  evaluate:
    cmd: python src/steps/evaluate.py data/split/test.csv data/prepared/preprocessed.csv
    deps:
    - path: data/models
      hash: md5
      md5: 84206f4d472ae0109d6643a72f38059b.dir
      size: 128813724
      nfiles: 4
    - path: data/prepared/preprocessed.csv
      hash: md5
      md5: 079954d1d68d9d9a93dd174e9e5481d8
      size: 51048735
    - path: data/split/test.csv
      hash: md5
      md5: 77165b7fc0eeb0972e924f30f36837a2
      size: 1989088
    - path: src/steps/evaluate.py
      hash: md5
      md5: 617d803982ca4ad6b72e11a1077eec6f
      size: 2074
    outs:
    - path: data/eval/metrics.json
      hash: md5
      md5: f8c0d12ab0141af909587b5de56415ce
      size: 1425
  split:
    cmd: python src/steps/split.py data/prepared/ data/split
    deps:
    - path: data/prepared
      hash: md5
      md5: 28869dd6b569a88cad596a1267dff66c.dir
      size: 74691779
      nfiles: 1
    - path: src/steps/prepare.py
      hash: md5
      md5: 6bc6f0d7d86d924c78644a61aa4e917d
      size: 7557
    params:
      params.yaml:
        book_column: ISBN
        filter_treshold: 10
        rating_column: Book-Rating
        rating_filter: 5
        split.seed: 20170428
        split.stratify_column: ISBN
        split.test_size: 0.1
        split.train_size: 0.75
        user_column: User-ID
        user_ratings_filter: 1
    outs:
    - path: data/split
      hash: md5
      md5: fb5561a4d4f1ab6c07548003f53c8191.dir
      size: 21662402
      nfiles: 3
  train_baseline_model:
    cmd: python src/steps/train_baseline_model.py data/split
    deps:
    - path: data/split/train.csv
      hash: md5
      md5: 8e9c6660879bef8756c70e9badde2268
      size: 15962532
    - path: data/split/val.csv
      hash: md5
      md5: dc639b23b667ffaca7de8b419dc22043
      size: 3533856
    - path: src/steps/train_baseline_model.py
      hash: md5
      md5: 764b774a449978f3986b4d2f0310a5f6
      size: 312
    params:
      params.yaml:
        book_column: ISBN
        filter_treshold: 10
        rating_column: Book-Rating
        train.method: mean
        train.test_file: test.csv
        train.train_file: train.csv
        train.val_file: val.csv
        user_column: User-ID
    outs:
    - path: data/models/baseline
      hash: md5
      md5: a3929e758500abb4a67c10ca3d3f7282.dir
      size: 100127
      nfiles: 1
  train_collaborative_filtering:
    cmd: python src/steps/train_collaborative_filtering.py data/split
    deps:
    - path: data/split/train.csv
      hash: md5
      md5: 8e9c6660879bef8756c70e9badde2268
      size: 15962532
    - path: data/split/val.csv
      hash: md5
      md5: dc639b23b667ffaca7de8b419dc22043
      size: 3533856
    - path: src/steps/train_collaborative_filtering.py
      hash: md5
      md5: ac74764d992ccd60d481ec750573bff3
      size: 292
    params:
      params.yaml:
        book_column: ISBN
        filter_treshold: 10
        rating_column: Book-Rating
        train.test_file: test.csv
        train.train_file: train.csv
        train.val_file: val.csv
        user_column: User-ID
    outs:
    - path: data/models/CollaborativeFiltering
      hash: md5
      md5: 7b994e7fba662858681b96322832ca65.dir
      size: 996777882
      nfiles: 1
  train_factorization:
    cmd: python src/steps/train_factorization.py data/split
    deps:
    - path: data/split/train.csv
      hash: md5
      md5: 8e9c6660879bef8756c70e9badde2268
      size: 15962532
    - path: data/split/val.csv
      hash: md5
      md5: dc639b23b667ffaca7de8b419dc22043
      size: 3533856
    - path: src/steps/train_factorization.py
      hash: md5
      md5: 79608b660670120cfb681a1092e4b7bc
      size: 289
    params:
      params.yaml:
        book_column: ISBN
        filter_treshold: 10
        rating_column: Book-Rating
        train.test_file: test.csv
        train.train_file: train.csv
        train.val_file: val.csv
        user_column: User-ID
    outs:
    - path: data/models/MatrixFactorization
      hash: md5
      md5: 6ebc248beac7bdc358a1db861aa99556.dir
      size: 908451848
      nfiles: 1
  train_s_transformer:
    cmd: python src/steps/train_s_transformer.py data/split
    deps:
    - path: data/split/train.csv
      hash: md5
      md5: 8e9c6660879bef8756c70e9badde2268
      size: 15962532
    - path: data/split/val.csv
      hash: md5
      md5: dc639b23b667ffaca7de8b419dc22043
      size: 3533856
    - path: src/steps/train_s_transformer.py
      hash: md5
      md5: 7877b0f8c7efc57093733ac31df1c6f4
      size: 282
    params:
      params.yaml:
        book_column: ISBN
        filter_treshold: 10
        rating_column: Book-Rating
        train.test_file: test.csv
        train.train_file: train.csv
        train.transformer_model: all-mpnet-base-v2
        train.val_file: val.csv
        user_column: User-ID
    outs:
    - path: data/models/STransformContentBase
      hash: md5
      md5: 736767ba756e04c41f83b204b6629253.dir
      size: 461383257
      nfiles: 1
  train_hybrid_nn_model:
    cmd: python src/steps/train_hybrid_nn_model.py data/split
    deps:
    - path: data/split/train.csv
      hash: md5
      md5: 8e9c6660879bef8756c70e9badde2268
      size: 15962532
    - path: data/split/val.csv
      hash: md5
      md5: dc639b23b667ffaca7de8b419dc22043
      size: 3533856
    - path: src/steps/train_hybrid_nn_model.py
      hash: md5
      md5: c8a381c82eb90b516a2fc3be745b0aed
      size: 290
    params:
      params.yaml:
        book_column: ISBN
        filter_treshold: 10
        rating_column: Book-Rating
        train.min_delta: 0.001
        train.num_epochs: 100
        train.patience: 3
        train.test_file: test.csv
        train.train_file: train.csv
        train.val_file: val.csv
        user_column: User-ID
    outs:
    - path: data/models/HybridNNmodel
      hash: md5
      md5: 77bddc9556ab860a949b4f5c3581f0a2.dir
      size: 141934277
      nfiles: 1
  train_content_based:
    cmd: python src/steps/train_content_based_filtering.py data/split
    deps:
    - path: data/split/test.csv
      hash: md5
      md5: 6cd07a18410f667d98efe93b4e76e075
      size: 2166014
    - path: data/split/train.csv
      hash: md5
      md5: 8e9c6660879bef8756c70e9badde2268
      size: 15962532
    - path: src/steps/train_content_based_filtering.py
      hash: md5
      md5: 17f9b122fbccd3b6080232c5aa37129e
      size: 293
    params:
      params.yaml:
        book_column: ISBN
        filter_treshold: 10
        rating_column: Book-Rating
        train.test_file: test.csv
        train.train_file: train.csv
        train.val_file: val.csv
        user_column: User-ID
    outs:
    - path: data/models/ContentBasedFiltering
      hash: md5
      md5: 4606cb1baafece49b2e55881037bc38d.dir
      size: 4376533
      nfiles: 1
  evaluate_baseline_model:
    cmd: python src/steps/evaluate.py data/split/test.csv data/prepared/preprocessed.csv
      baseline
    deps:
    - path: data/models/baseline
      hash: md5
      md5: a3929e758500abb4a67c10ca3d3f7282.dir
      size: 100127
      nfiles: 1
    - path: data/prepared/preprocessed.csv
      hash: md5
      md5: 2519acedafce6857071d32141a1ffdb4
      size: 74691779
    - path: data/split/test.csv
      hash: md5
      md5: 6cd07a18410f667d98efe93b4e76e075
      size: 2166014
    - path: src/steps/evaluate.py
      hash: md5
      md5: 8d40ac4d577e25c3f54359d06b0f3e3b
      size: 2307
    params:
      params.yaml:
        book_column: ISBN
        evaluate.k_list:
        - 5
        - 10
        - 20
        filter_treshold: 10
        rating_column: Book-Rating
        user_column: User-ID
    outs:
    - path: data/eval/metrics_baseline.json
      hash: md5
      md5: 55b302e6b6ffce2446ffbf737d86a04f
      size: 473
  evaluate_s_transformer:
    cmd: python src/steps/evaluate.py data/split/test.csv data/prepared/preprocessed.csv
      STransformContentBase
    deps:
    - path: data/models/STransformContentBase
      hash: md5
      md5: 736767ba756e04c41f83b204b6629253.dir
      size: 461383257
      nfiles: 1
    - path: data/prepared/preprocessed.csv
      hash: md5
      md5: 2519acedafce6857071d32141a1ffdb4
      size: 74691779
    - path: data/split/test.csv
      hash: md5
      md5: 6cd07a18410f667d98efe93b4e76e075
      size: 2166014
    - path: src/steps/evaluate.py
      hash: md5
      md5: 8d40ac4d577e25c3f54359d06b0f3e3b
      size: 2307
    params:
      params.yaml:
        book_column: ISBN
        evaluate.k_list:
        - 5
        - 10
        - 20
        filter_treshold: 10
        rating_column: Book-Rating
        user_column: User-ID
    outs:
    - path: data/eval/metrics_STransformContentBase.json
      hash: md5
      md5: 6ddeb7f31a4074543e74ff6a851cf06b
      size: 479
  evaluate_hybrid_nn_model:
    cmd: python src/steps/evaluate.py data/split/test.csv data/prepared/preprocessed.csv
      HybridNNmodel
    deps:
    - path: data/models/HybridNNmodel
      hash: md5
      md5: 77bddc9556ab860a949b4f5c3581f0a2.dir
      size: 141934277
      nfiles: 1
    - path: data/prepared/preprocessed.csv
      hash: md5
      md5: 2519acedafce6857071d32141a1ffdb4
      size: 74691779
    - path: data/split/test.csv
      hash: md5
      md5: 6cd07a18410f667d98efe93b4e76e075
      size: 2166014
    - path: src/steps/evaluate.py
      hash: md5
      md5: 8d40ac4d577e25c3f54359d06b0f3e3b
      size: 2307
    params:
      params.yaml:
        book_column: ISBN
        evaluate.k_list:
        - 5
        - 10
        - 20
        filter_treshold: 10
        rating_column: Book-Rating
        user_column: User-ID
    outs:
    - path: data/eval/metrics_HybridNNmodel.json
      hash: md5
      md5: 29e42a105d122e318a97839decbcb8ae
      size: 473
  evaluate_factorization:
    cmd: python src/steps/evaluate.py data/split/test.csv data/prepared/preprocessed.csv
      MatrixFactorization
    deps:
    - path: data/models/MatrixFactorization
      hash: md5
      md5: 6ebc248beac7bdc358a1db861aa99556.dir
      size: 908451848
      nfiles: 1
    - path: data/prepared/preprocessed.csv
      hash: md5
      md5: 2519acedafce6857071d32141a1ffdb4
      size: 74691779
    - path: data/split/test.csv
      hash: md5
      md5: 6cd07a18410f667d98efe93b4e76e075
      size: 2166014
    - path: src/steps/evaluate.py
      hash: md5
      md5: 8d40ac4d577e25c3f54359d06b0f3e3b
      size: 2307
    params:
      params.yaml:
        book_column: ISBN
        evaluate.k_list:
        - 5
        - 10
        - 20
        filter_treshold: 10
        rating_column: Book-Rating
        user_column: User-ID
    outs:
    - path: data/eval/metrics_MatrixFactorization.json
      hash: md5
      md5: 10d1d31abd178c5685262aba6324b4a0
      size: 476
  evaluate_collaborative_filtering:
    cmd: python src/steps/evaluate.py data/split/test.csv data/prepared/preprocessed.csv
      CollaborativeFiltering
    deps:
    - path: data/models/CollaborativeFiltering
      hash: md5
      md5: 7b994e7fba662858681b96322832ca65.dir
      size: 996777882
      nfiles: 1
    - path: data/prepared/preprocessed.csv
      hash: md5
      md5: 2519acedafce6857071d32141a1ffdb4
      size: 74691779
    - path: data/split/test.csv
      hash: md5
      md5: 6cd07a18410f667d98efe93b4e76e075
      size: 2166014
    - path: src/steps/evaluate.py
      hash: md5
      md5: 8d40ac4d577e25c3f54359d06b0f3e3b
      size: 2307
    params:
      params.yaml:
        book_column: ISBN
        evaluate.k_list:
        - 5
        - 10
        - 20
        filter_treshold: 10
        rating_column: Book-Rating
        user_column: User-ID
    outs:
    - path: data/eval/metrics_CollaborativeFiltering.json
      hash: md5
      md5: e51beb4cb4ea36f6b7961cba09856720
      size: 482
  evaluate_content_based:
    cmd: python src/steps/evaluate.py data/split/test.csv data/prepared/preprocessed.csv
      ContentBasedFiltering
    deps:
    - path: data/models/ContentBasedFiltering
      hash: md5
      md5: 4606cb1baafece49b2e55881037bc38d.dir
      size: 4376533
      nfiles: 1
    - path: data/prepared/preprocessed.csv
      hash: md5
      md5: 2519acedafce6857071d32141a1ffdb4
      size: 74691779
    - path: data/split/test.csv
      hash: md5
      md5: 6cd07a18410f667d98efe93b4e76e075
      size: 2166014
    - path: src/steps/evaluate.py
      hash: md5
      md5: 8d40ac4d577e25c3f54359d06b0f3e3b
      size: 2307
    params:
      params.yaml:
        book_column: ISBN
        evaluate.k_list:
        - 5
        - 10
        - 20
        filter_treshold: 10
        rating_column: Book-Rating
        user_column: User-ID
    outs:
    - path: data/eval/metrics_ContentBasedFiltering.json
      hash: md5
      md5: 47264d73d1f68a7f7aaadb3a440a55ea
      size: 482
  train_hybrid_MF_stransformer:
    cmd: python src/steps/train_hybrid_MF_stransformer.py data/split
    deps:
    - path: data/split/test.csv
      hash: md5
      md5: 6cd07a18410f667d98efe93b4e76e075
      size: 2166014
    - path: data/split/train.csv
      hash: md5
      md5: 8e9c6660879bef8756c70e9badde2268
      size: 15962532
    - path: src/steps/train_hybrid_MF_stransformer.py
      hash: md5
      md5: d0973cf704872d269de1d631dc157b98
      size: 292
    params:
      params.yaml:
        book_column: ISBN
        filter_treshold: 10
        rating_column: Book-Rating
        train.test_file: test.csv
        train.train_file: train.csv
        train.val_file: val.csv
        user_column: User-ID
    outs:
    - path: data/models/Hybrid_MF_STransformer
      hash: md5
      md5: 57f5da4464deff6bf5bac5d2b7485579.dir
      size: 1368884514
      nfiles: 1
  evaluate_hybrid_MF_stransformer:
    cmd: python src/steps/evaluate.py data/split/test.csv data/prepared/preprocessed.csv
      Hybrid_MF_STransformer
    deps:
    - path: data/models/Hybrid_MF_STransformer
      hash: md5
      md5: 57f5da4464deff6bf5bac5d2b7485579.dir
      size: 1368884514
      nfiles: 1
    - path: data/prepared/preprocessed.csv
      hash: md5
      md5: 2519acedafce6857071d32141a1ffdb4
      size: 74691779
    - path: data/split/test.csv
      hash: md5
      md5: 6cd07a18410f667d98efe93b4e76e075
      size: 2166014
    - path: src/steps/evaluate.py
      hash: md5
      md5: 8d40ac4d577e25c3f54359d06b0f3e3b
      size: 2307
    params:
      params.yaml:
        book_column: ISBN
        evaluate.k_list:
        - 5
        - 10
        - 20
        filter_treshold: 10
        rating_column: Book-Rating
        user_column: User-ID
    outs:
    - path: data/eval/metrics_Hybrid_MF_STransformer.json
      hash: md5
      md5: b8878c317c2662122c247c189c2d517a
      size: 480
